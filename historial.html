<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Historial de Citas - Compuniverso</title>
    <link rel="icon" href="img/favicon.ico" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

    <!-- Iconos -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

    <!-- CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/formulario-cita.css" rel="stylesheet" />

</head>
<body style ="
    background-image: url('img/Tecnoimg.PNG');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    background-color: rgba(255,255,255,0.7);
    background-blend-mode: lighten;
">
    <!-- Topbar -->
    <div class="container-fluid bg-primary text-white d-none d-lg-flex">
        <div class="container py-3">
            <div class="d-flex align-items-center">
                <a href="index.html">
                    <h2 class="text-white fw-bold m-0">Compuniverso</h2>
                </a>
                <div class="ms-auto d-flex align-items-center">
                    <span id="nombreUsuario" class="d-flex align-items-center gap-2">
                        <a href="inicioperfil.html"
                           id="enlaceUsuario"
                           class="text-white text-decoration-underline fw-bold"></a>
                        <i class="fas fa-user-circle text-white" style="font-size: 1.3rem"></i>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const usuarioActivo = JSON.parse(localStorage.getItem("usuarioActivo"));
        if (usuarioActivo && usuarioActivo.nombre) {
            document.getElementById("enlaceUsuario").innerText = usuarioActivo.nombre;
        } else {
            document.getElementById("nombreUsuario").style.display = "none";
        }
    </script>

    <!-- Navbar -->
    <div class="container-fluid bg-white sticky-top">
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light bg-white p-lg-0">
                <a href="index.html" class="navbar-brand d-lg-none">
                    <h1 class="fw-bold m-0">Compuniverso</h1>
                </a>
                <button class="navbar-toggler me-0"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#navbarCollapse">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <div class="navbar-nav">
                        <a href="index.html" class="nav-item nav-link active">Inicio</a>
                        <a href="service.html" class="nav-item nav-link">Servicios</a>
                        <a href="about.html" class="nav-item nav-link">Productos</a>
                        <a href="sugerencias.html" class="nav-item nav-link">Sugerencias</a>
                    </div>
                </div>
            </nav>
        </div>
    </div>


    <!-- Botón Subir -->
    <a href="#" class="btn btn-primary position-fixed bottom-0 end-0 m-4 rounded-circle shadow" style="z-index: 999;">
        ↑
    </a>
    <div class="page-wrapper">

        <div class="container my-5">
            <h2 class="historial-titulo text-center mb-4">
                <i class="fas fa-clipboard-list"></i> Historial de Citas Programadas
            </h2>

            <!-- Botón Exportar -->
            <div class="text-end mb-3">
                <button id="btnExportar" class="btn btn-success">
                    <i class="fas fa-file-pdf"></i> Exportar historial
                </button>
            </div>

            <div class="table-responsive">
                <table class="table table-bordered text-center align-middle">
                    <thead class="table-primary">
                        <tr>
                            <th>Nombre</th>
                            <th>Correo</th>
                            <th>Teléfono</th>
                            <th>Fecha</th>
                            <th>Hora</th>
                            <th>Servicio</th>
                            <th>Comentarios</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-citas-body">
                        <!-- Rellenado por JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Script para mostrar y eliminar citas -->
    <script>
        function cargarCitas() {
            const citas = JSON.parse(localStorage.getItem("citasProgramadas")) || [];
            const tbody = document.getElementById("tabla-citas-body");
            tbody.innerHTML = ""; // Limpiar contenido anterior

            citas.forEach((cita, index) => {
                const fila = document.createElement("tr");

                fila.innerHTML = `
<<<<<<< HEAD
                                            <td>${cita.nombre}</td>
                                            <td>${cita.correo}</td>
                                            <td>${cita.telefono}</td>
                                            <td>${cita.fecha}</td>
                                            <td>${cita.hora}</td>
                                            <td>${cita.servicio}</td>
                                            <td>${cita.comentarios}</td>
                                            <td>
                                                <button class="btn btn-danger btn-sm" onclick="eliminarCita(${index})">
                                                    <i class="fas fa-trash-alt"></i> Eliminar
                                                </button>
                                            </td>
                                        `;
=======
                        <td>${cita.nombre}</td>
                        <td>${cita.correo}</td>
                        <td>${cita.telefono}</td>
                        <td>${cita.fecha}</td>
                        <td>${cita.hora}</td>
                        <td>${cita.servicio}</td>
                        <td>${cita.comentarios}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="eliminarCita(${index})">
                                <i class="fas fa-trash-alt"></i> Eliminar
                            </button>
                        </td>
                    `;
>>>>>>> f7164d040bf31da41d01940316c1df3b84c19882

                tbody.appendChild(fila);
            });
        }

        function eliminarCita(indice) {
            const citas = JSON.parse(localStorage.getItem("citasProgramadas")) || [];
            if (confirm("¿Estás seguro de que deseas eliminar esta cita?")) {
                citas.splice(indice, 1);
                localStorage.setItem("citasProgramadas", JSON.stringify(citas));
                cargarCitas();
            }
        }

        // Cargar citas al iniciar
        document.addEventListener("DOMContentLoaded", cargarCitas);
    </script>

    <!-- Librería jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Script Exportar a PDF -->
    <script>
        document.getElementById("btnExportar").addEventListener("click", () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(16);
            doc.text("Historial de Citas", 10, 10);
            doc.setFontSize(12);

            const citas = JSON.parse(localStorage.getItem("citasProgramadas")) || [];
            let y = 20;

            citas.forEach((cita, i) => {
                doc.text(`${i + 1}. Nombre: ${cita.nombre}`, 10, y);
                y += 6;
                doc.text(`   Correo: ${cita.correo}`, 10, y);
                y += 6;
                doc.text(`   Teléfono: ${cita.telefono}`, 10, y);
                y += 6;
                doc.text(`   Fecha: ${cita.fecha} Hora: ${cita.hora}`, 10, y);
                y += 6;
                doc.text(`   Servicio: ${cita.servicio}`, 10, y);
                y += 6;
                doc.text(`   Comentarios: ${cita.comentarios || "Ninguno"}`, 10, y);
                y += 10;
            });

            doc.save("historial_citas.pdf");
        });
    </script>

    <footer class="footer-simple">
        © 2025 Compuniverso. Todos los derechos reservados.
    </footer>
    </body>
</html>
